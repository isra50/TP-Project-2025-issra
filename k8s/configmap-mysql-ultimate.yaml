apiVersion: v1
kind: ConfigMap
metadata:
  name: tp-projet-config
  namespace: tp-projet-2025
data:
  application.yml: |
    spring:
      application:
        name: tp-projet-2025
    
      datasource:
        url: jdbc:mysql://mysql-service.tp-projet-2025.svc.cluster.local:3306/tpfoyer?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
        username: tpuser
        password: tppassword
        driver-class-name: com.mysql.cj.jdbc.Driver
        hikari:
          connection-timeout: 30000
          maximum-pool-size: 10
    
      jpa:
        hibernate:
          ddl-auto: update
        show-sql: true
        database-platform: org.hibernate.dialect.MySQL8Dialect
        properties:
          hibernate:
            format_sql: true
    
      web:
        resources:
          static-locations: file:/static/,classpath:/static/,classpath:/public/,classpath:/resources/,classpath:/META-INF/resources/
  
    server:
      port: 8080
      servlet:
        context-path: /
  
    management:
      endpoints:
        web:
          exposure:
            include: "*"
      endpoint:
        health:
          show-details: always
          probes:
            enabled: true
  
    logging:
      level:
        org.springframework: INFO
        tn.esprit: DEBUG
  
    app:
      welcome-message: "TP Projet 2025 - Déploiement Kubernetes Réussi"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: static-content
  namespace: tp-projet-2025
data:
  index.html: |
    <!DOCTYPE html>
    <html>
    <head>
        <title>TP Projet 2025 - Success</title>
        <meta charset="UTF-8">
        <style>
            body { font-family: Arial, sans-serif; margin: 0; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
            .container { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 40px; border-radius: 20px; max-width: 800px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }
            h1 { font-size: 3em; margin-bottom: 20px; color: #4CAF50; }
            .success { font-size: 1.5em; margin: 20px 0; padding: 15px; background: rgba(76, 175, 80, 0.2); border-radius: 10px; border: 2px solid #4CAF50; }
            .info-box { background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left; }
            .endpoints { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-top: 30px; }
            .endpoint { background: white; color: #333; padding: 15px 25px; border-radius: 10px; text-decoration: none; font-weight: bold; transition: transform 0.3s; }
            .endpoint:hover { transform: translateY(-5px); background: #f0f0f0; }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>TP CD - Mission Accomplie !</h1>
            <div class="success">
                Déploiement Spring Boot + MySQL sur Kubernetes Réussi
            </div>
            <div class="info-box">
                <h3>Configuration du Service :</h3>
                <p><strong>Type :</strong> LoadBalancer</p>
                <p><strong>Ports :</strong> 80 (HTTP), 8081 (Monitoring)</p>
                <p><strong>Base de données :</strong> MySQL 8.0 - tpfoyer</p>
                <p><strong>Application :</strong> Spring Boot 3.5.6</p>
            </div>
            <h3>Endpoints disponibles :</h3>
            <div class="endpoints">
                <a href="/actuator/health" class="endpoint">Health Check</a>
                <a href="/actuator/info" class="endpoint">Info Application</a>
                <a href="/actuator/metrics" class="endpoint">Métriques</a>
                <a href="/actuator/env" class="endpoint">Variables d'env</a>
            </div>
            <p style="margin-top: 40px; font-style: italic;">
                Ceci démontre un pipeline CI/CD complet : Docker → Kubernetes → Production
            </p>
        </div>
    </body>
    </html>
